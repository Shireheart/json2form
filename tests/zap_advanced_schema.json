{
    "$schema": "http://json-schema.org/draft-07/schema",
    "$id": "https://www.securecodebox.io/docs/scanners/zap-advanced/",
    "title": "Configuration of the zap-advanced-scan script",
    "description": "All of the different configuration options that can be used to configure the ZAP advanced scan.",
    "type": "object",
    "properties": {
        "zapConfiguration": {
            "type": "object",
            "title": "ZAP Configurations",
            "properties": {
                "global": { "$ref": "#/definitions/zap-global" },
                "contexts": { "$ref": "#/definitions/zap-contexts" },
                "apis": { "$ref": "#/definitions/zap-apis" },
                "spiders": { "$ref": "#/definitions/zap-spiders" },
                "scanners": { "$ref": "#/definitions/zap-scanners" }
            }
        }
    },
    "required": [
    ],

    "definitions": {
        "includePaths": {
            "type": "array",
            "title": "List of global regexes to include",
            "items": {
                "type": "string",
                "title": "Regexes"
            }
        },
        "excludePaths": {
            "type": "array",
            "title": "List of global regexes to exclude",
            "items": {
                "type": "string",
                "title": "Regexes"
            }
        },
        "engine": {
            "type": "string",
            "title": "Script engine",
            "description": "The script engine. Possible values are: 'Graal.js', 'Oracle Nashorn' for Javascript and 'Mozilla Zest' for Zest Scripts",
            "enum": [
                "Graal.js",
                "Oracle Nashorn",
                "Mozilla Zest"
            ]
        },
        "context": {
            "type": "string",
            "title": "Name of the context to reference",
            "description": "The Name of the context (zapConfiguration.contexts[x].name) to reference, default: the first context available"
        },
        "scripts": {
            "type": "array",
            "title": "ZAP Scripts configuration",
            "description": "Configures existings ZAP Scripts or add new ZAP Scripts. For example can be used if a proxy script must be loaded. Proxy scripts are executed for every request traversing ZAP",
            "items": {
                "type": "object",
                "title": "ZAP Script configuration",
                "properties": {
                    "name": {
                        "type": "string",
                        "title": "Script name"
                    },
                    "enabled": {
                        "type": "boolean",
                        "title": "True if the script must be enabled, false otherwise"
                    },
                    "filePath": {
                        "type": "string",
                        "title": "The complete filepath (inside the ZAP Container!) to the script file"
                    },
                    "engine": { "$ref": "#/definitions/engine" },
                    "type": {
                        "type": "string",
                        "title": "The type of script engine used",
                        "description": "Possible values are: 'httpsender', 'authentication', 'session', 'proxy', ...",
                        "enum": [
                            "httpsender",
                            "authentication",
                            "session",
                            "proxy"
                        ]
                    },
                    "description": {
                        "type": "string",
                        "title": "A short description for the script"
                    }
                }
            }
        },
        "strength": {
            "type": "string",
            "title": "Default Attack Strength for all rules",
            "description": "The default Attack Strength for all rules, one of Low, Medium, High, Insane (not recommended), default: Medium",
            "enum": [
                "Low",
                "Medium",
                "High",
                "Insane"
            ],
            "default": "Medium"
        },
        "threshold": {
            "type": "string",
            "title": "Default Alert Threshold for all rules",
            "description": "The default Alert Threshold for all rules, one of Off, Low, Medium, High, default: Medium",
            "enum": [
                "Low",
                "Medium",
                "High",
                "Insane"
            ],
            "default": "Medium"
        },

        "zap-global": {
            "type": "object",
            "title": "ZAP Global Configurations",
            "description": "Optional general ZAP Configurations settings",
            "properties": {
                "sessionName": {
                    "type": "string",
                    "title": "ZAP internal Session name",
                    "default": "secureCodeBox"
                },
                "addonUpdate": {
                    "type": "boolean",
                    "title": "Updates all installed ZAP AddOns on startup if true",
                    "default": true
                },
                "addonInstall": {
                    "type": "array",
                    "title": "Installs additional ZAP AddOns on startup, listed by their name",
                    "items": {
                        "type": "string",
                        "title": "Name of AddOns"
                    }
                },
                "includePaths": { "$ref": "#/definitions/includePaths" },
                "excludePaths": { "$ref": "#/definitions/excludePaths" },
                "proxy": {
                    "type": "object",
                    "title": "Proxy configuration",
                    "description": "Configures a proxy for ZAP to tunnel the traffic somewhere else",
                    "properties": {
                        "enabled": {
                            "type": "boolean",
                            "title": "Define if an outgoing proxy server is used"
                        },
                        "port": {
                            "type": "integer",
                            "title": "The proxy port to use"
                        },
                        "address": {
                            "type": "string",
                            "title": "Outgoing proxy address and port",
                            "description": "MANDATORY only if useProxyChain is True, ignored otherwise"
                        },
                        "skipProxyAddresses": {
                            "type": "array",
                            "title": "Addresses to skip",
                            "description": "Define the addresses to skip in case useProxyChain is True. Ignored otherwise. List can be empty",
                            "items": {
                                "type": "string",
                                "title": "IP or host"
                            }
                        },
                        "authentication": {
                            "type": "object",
                            "title": "Define if proxy server needs authentication",
                            "description": "MANDATORY only if proxy.enabled is True. Ignored otherwise.",
                            "properties": {
                                "enabled": {
                                    "type": "boolean",
                                    "title": "Enabled"
                                },
                                "proxyUsername": {
                                    "type": "string",
                                    "title": "Proxy Username"
                                },
                                "proxyPassword": {
                                    "type": "string",
                                    "title": "Proxy Password"
                                },
                                "proxyRealm": {
                                    "type": "string",
                                    "title": "Proxy Realm"
                                }
                            }
                        }
                    }
                },
                "scripts": { "$ref": "#/definitions/scripts" }
            }
        },
        "zap-contexts": {
            "type": "array",
            "title": "ZAP Context definitions",
            "description": "Optional list of ZAP Context definitions",
            "items": {
                "type": "object",
                "title": "ZAP Context",
                "properties": {
                    "name": {
                        "type": "string",
                        "title": "Name to be used to refer to this context in other jobs, mandatory"
                    },
                    "url": {
                        "type": "string",
                        "title": "The top level URL"
                    },
                    "includePaths": { "$ref": "#/definitions/includePaths" },
                    "excludePaths": { "$ref": "#/definitions/excludePaths" },
                    "technology": {
                        "type": "object",
                        "title": "Technology list",
                        "properties": {
                            "included": {
                                "type": "array",
                                "title": "Technologies enabled",
                                "description": "By default all technologies are enabed for each context by ZAP. You can use the following config to change that explicitly",
                                "items": {
                                    "type": "string",
                                    "title": "Technology"
                                }
                            },
                            "excluded": {
                                "type": "array",
                                "title": "Technologies excluded",
                                "description": "By default all technologies are enabed for each context by ZAP. You can use the following config to change that explicitly",
                                "items": {
                                    "type": "string",
                                    "title": "Technology"
                                }
                            }
                        }
                    },
                    "authentication": {
                        "type": "object",
                        "title": "Authentication Configuration",
                        "description": "Authentication Configuration that can be uses by ZAP Spider and/or Scanner. You need to reference the `context` name in the corresponding `zapConfiguration.spiders[0].context` and `zapConfiguration.scanners[0].context` section if you want to use them",
                        "properties": {
                            "type": {
                                "type": "string",
                                "title": "Type of authentication",
                                "description": "Currently supports \"basic-auth\", \"form-based\", \"json-based\", \"script-based\".",
                                "enum": [
                                    "basic-auth",
                                    "form-based",
                                    "json-based",
                                    "script-based"
                                ]
                            },
                            "script-based": {
                                "type": "object",
                                "title": "Script based configuration",
                                "description": "Optional, only mandatory if zapConfiguration.contexts[0].authentication.type: \"script-based\". More ZAP details about 'script based' authentication can be found here: https://www.zaproxy.org/docs/api/#script-based-authentication.",
                                "properties": {
                                    "name": {
                                        "type": "string",
                                        "title": "The name of the authentication script"
                                    },
                                    "enabled": {
                                        "type": "boolean",
                                        "title": "Enables the script if true, otherwise false"
                                    },
                                    "engine": { "$ref": "#/definitions/engine" },
                                    "filePath": {
                                        "type": "string",
                                        "title": "Path to the script file",
                                        "description": "Must be a full path to the script file inside the ZAP container (corresponding to the configMap FileMount)"
                                    },
                                    "description": {
                                        "type": "string",
                                        "title": "A short description for the script"
                                    },
                                    "arguments": {
                                        "type": "object",
                                        "title": "Script arguments",
                                        "description": "Optional list of all script arguments needed to be passed to the script.",
                                        "patternProperties": {
                                            "^.*$": {
                                                "anyOf": [
                                                    {
                                                        "type": "string",
                                                        "title": "Argument value"
                                                    }
                                                ]
                                            }
                                        },
                                        "additionalProperties": false
                                    }
                                }
                            },
                            "basic-auth": {
                                "type": "object",
                                "title": "Basic auth configuration",
                                "description": "Optional, only mandatory if zapConfiguration.contexts[0].authentication.type: \"basic-auth\". More ZAP details about 'basic auth' based authentication can be found here: https://www.zaproxy.org/docs/api/?python#general-steps.",
                                "properties": {
                                    "hostname": {
                                        "type": "string",
                                        "title": "Hostname",
                                        "description": "The hostname that must be for the basic authentication"
                                    },
                                    "realm": {
                                        "type": "string",
                                        "title": "Realm",
                                        "description": "The realm that must be for the basic authentication"
                                    },
                                    "port": {
                                        "type": "integer",
                                        "title": "Port",
                                        "description": "The port that must be for the basic authentication"
                                    }
                                }
                            },
                            "form-based": {
                                "type": "object",
                                "title": "Form based configuration",
                                "description": "Optional, only mandatory if zapConfiguration.contexts[0].authentication.type: \"form-based\". More ZAP details about 'form-based' based authentication can be found here: https://www.zaproxy.org/docs/api/#form-based-authentication.",
                                "properties": {
                                    "loginUrl": {
                                        "type": "string",
                                        "title": "URL to the login form",
                                        "description": "The URL to the login form that must be used"
                                    },
                                    "loginRequestData": {
                                        "type": "string",
                                        "title": "Mapping of username and password",
                                        "description": "The mapping of username and password to HTTP post parameters. Hint: the value must be escaped already to prevent YAML parser colidations. Example the intended value 'username={%username%}&password={%password%}' must be ''username%3D%7B%25username%25%7D%26password%3D%7B%25password%25%7D."
                                    }
                                }
                            },
                            "json-based": {
                                "type": "object",
                                "title": "Json based configuration",
                                "description": "Optional, only mandatory if zapConfiguration.contexts[0].authentication.type: \"json-based\". More ZAP details about 'json-based' based authentication can be found here: https://www.zaproxy.org/docs/api/#json-based-authentication.",
                                "properties": {
                                    "loginUrl": {
                                        "type": "string",
                                        "title": "Login URL"
                                    },
                                    "loginRequestData": {
                                        "type": "string",
                                        "title": "Login request data",
                                        "description": "must be escaped already to prevent yaml parser colidations '{\"user\":{\"id\":1,\"email\":\"test@test.com\"}}''"
                                    }
                                }
                            },
                            "verification": {
                                "type": "object",
                                "title": "Current ZAP User Session verification",
                                "description": "Indicates if the current Zap User Session is based on a valid authentication (loggedIn) or not (loggedOut)",
                                "properties": {
                                    "isLoggedInIndicator": {
                                        "type": "string",
                                        "title": "ZAP indiator string for loggedIn Users",
                                        "description": "The optional ZAP indiator string for loggedIn Users"
                                    },
                                    "isLoggedOutIndicator": {
                                        "type": "string",
                                        "title": "ZAP indiator string for loggedOut Users",
                                        "description": "The optional ZAP indiator string for loggedOut Users"
                                    }
                                }
                            }
                        }
                    },
                    "users": {
                        "type": "array",
                        "title": "Users with credentials",
                        "description": "A list of users with credentials which can be referenced by spider or scanner configurations to run them authenticated (you have to configure the authentiation settings). Hint: you can use secretMaps to seperate credentails.",
                        "items": {
                            "type": "object",
                            "title": "User",
                            "properties": {
                                "name": {
                                    "type": "string",
                                    "title": "The name of this user configuration"
                                },
                                "username": {
                                    "type": "string",
                                    "title": "The username used to authenticate this user"
                                },
                                "password": {
                                    "type": "string",
                                    "title": "The password used to authenticate this user"
                                },
                                "forced": {
                                    "type": "boolean",
                                    "title": "True if this is the default user",
                                    "description": "Optional, could be set to True only once in the users list. If not defined the first user in the list will be forced by default."
                                }
                            }
                        }
                    },
                    "session": {
                        "type": "object",
                        "title": "ZAP session configuration",
                        "description": "The optional ZAP session configuration",
                        "properties": {
                            "type": {
                                "type": "string",
                                "title": "ZAP Session type",
                                "description": "The ZAP Session type indicates how Zap identifies sessions. Currently supports the following types: \"scriptBasedSessionManagement\", \"cookieBasedSessionManagement\", \"httpAuthSessionManagement\""
                            },
                            "scriptBasedSessionManagement": {
                                "type": "object",
                                "title": "Script based configuration",
                                "description": "Optional, only mandatory if zapConfiguration.contexts[0].session.type: \"scriptBasedSessionManagement\". Additional configrations for the session type \"scriptBasedSessionManagement\"",
                                "properties": {
                                    "name": {
                                        "type": "string",
                                        "title": "Name of the session script",
                                        "description": "The name of the session script to be used."
                                    },
                                    "enabled": {
                                        "type": "boolean",
                                        "title": "Enables the script if true",
                                        "description": "Enables the script if true, otherwise false"
                                    },
                                    "engine": { "$ref": "#/definitions/engine" },
                                    "fileName": {
                                        "type": "string",
                                        "title": "Path to the script file",
                                        "description": "Must be a full path to the script file inside the ZAP container (corresponding to the configMap FileMount)"
                                    },
                                    "description": {
                                        "type": "string",
                                        "title": "Description used for the script",
                                        "description": "An optional description used for the script."
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "zap-apis": {
            "type": "array",
            "title": "ZAP OpenAPI configurations",
            "description": "Optional list of ZAP OpenAPI configurations",
            "items": {
                "type": "object",
                "title": "ZAP OpenAPI configuration",
                "properties": {
                    "name": {
                        "type": "string",
                        "title": "Name of the api configuration"
                    },
                    "context": { "$ref": "#/definitions/context" },
                    "format": {
                        "type": "string",
                        "title": "Used format of the API",
                        "description": "The used format of the API. Possible values are: 'openapi', 'grapql', 'soap'",
                        "enum": [
                            "openapi",
                            "grapql",
                            "soap"
                        ]
                    },
                    "url": {
                        "type": "string",
                        "title": "URL of the API",
                        "description": "Url to start importing the API from, default: first context URL"
                    },
                    "hostOverride": {
                        "type": "string",
                        "title": "Override host setting",
                        "description": "Optional: Override host setting in the API (e.g. swagger.json) if your API is using some kind of internal routing."
                    },
                    "configMap": {
                        "type": "object",
                        "title": "Associated configMap",
                        "description": "Optional: Assumes that the API Spec has been saved to a configmap in the namespace of the scan / this release. Should be null if not used.",
                        "properties": {
                            "name": {
                                "type": "string",
                                "title": "Name of the configMap"
                            },
                            "key": {
                                "type": "string",
                                "title": "Key / property in the configMap which holds the openapi spec file."
                            }
                        }
                    },
                    "spec": {
                        "type": "string",
                        "title": "API spec",
                        "description": "Allows to embed the entire yaml / json API spec in the values (e.g. OpenAPI YAML spec). Should be null if not used."
                    },
                    "scripts": { "$ref": "#/definitions/scripts" }
                }
            }
        },
        "zap-spiders": {
            "type": "array",
            "title": "ZAP Spider configurations",
            "description": "Optional list of ZAP Spider configurations",
            "items": {
                "type": "object",
                "title": "ZAP Spider configuration",
                "properties": {
                    "name": {
                        "type": "string",
                        "title": "Name of the spider configuration"
                    },
                    "context": { "$ref": "#/definitions/context" },
                    "user": {
                        "type": "string",
                        "title": "Name of the user",
                        "description": "The Name of the user (zapConfiguration.contexts[0].users[0].name) used to authenticate the spider with"
                    },
                    "url": {
                        "type": "string",
                        "title": "Url to start spidering from",
                        "description": "Url to start spidering from, default: first context URL"
                    },
                    "ajax": {
                        "type": "boolean",
                        "title": "Whether to use the ZAP ajax spider",
                        "description": "Whether to use the ZAP ajax spider, default: false",
                        "default": false
                    },
                    "failIfFoundUrlsLessThan": {
                        "type": "integer",
                        "title": "Fail if spider finds less than",
                        "description": "Fail if spider finds less than the specified number of URLs, default: 0",
                        "default": 0
                    },
                    "warnIfFoundUrlsLessThan": {
                        "type": "integer",
                        "title": "Warn if spider finds less than",
                        "description": "Warn if spider finds less than the specified number of URLs, default: 0",
                        "default": 0
                    },
                    "maxDuration": {
                        "type": "integer",
                        "title": "Max time the spider run for",
                        "description": "The max time in minutes the spider will be allowed to run for, default: 0 unlimited",
                        "default": 0
                    },
                    "maxDepth": {
                        "type": "integer",
                        "title": "Max tree depth to explore",
                        "description": "The maximum tree depth to explore, default 5",
                        "default": 5
                    },
                    "maxChildren": {
                        "type": "integer",
                        "title": "Max number of children to add to each node",
                        "description": "The maximum number of children to add to each node in the tree",
                        "default": 10
                    },
                    "acceptCookies": {
                        "type": "boolean",
                        "title": "Whether the spider will accept cookies",
                        "description": "Whether the spider will accept cookies, default: true",
                        "default": true
                    },
                    "handleODataParametersVisited": {
                        "type": "boolean",
                        "title": "Whether the spider will handle OData responses",
                        "description": "Whether the spider will handle OData responses, default: false",
                        "default": false
                    },
                    "handleParameters": {
                        "type": "string",
                        "title": "How query string parameters are used",
                        "description": "Enum [ignore_completely, ignore_value, use_all]: How query string parameters are used when checking if a URI has already been visited, default: use_all",
                        "enum": [
                            "ignore_completely",
                            "ignore_value",
                            "use_all"
                        ]
                    },
                    "maxParseSizeBytes": {
                        "type": "integer",
                        "title": "Max size of a response parsed",
                        "description": "The max size of a response that will be parsed, default: 2621440 - 2.5 Mb",
                        "default": 2621440
                    },
                    "parseComments": {
                        "type": "boolean",
                        "title": "True if spider parses HTML comments for URLs",
                        "description": "Whether the spider will parse HTML comments in order to find URLs, default: true",
                        "default": true
                    },
                    "parseGit": {
                        "type": "boolean",
                        "title": "True if spider parses Git metadata to find URLs",
                        "description": "Whether the spider will parse Git metadata in order to find URLs, default: false",
                        "default": false
                    },
                    "parseRobotsTxt": {
                        "type": "boolean",
                        "title": "True if spider parses 'robots.txt' to find URLs",
                        "description": "Whether the spider will parse 'robots.txt' files in order to find URLs, default: true",
                        "default": true
                    },
                    "parseSitemapXml": {
                        "type": "boolean",
                        "title": "True if spider parses 'sitemap.xml' to find URLs",
                        "description": "Whether the spider will parse 'sitemap.xml' files in order to find URLs, default: true",
                        "default": true
                    },
                    "parseSVNEntries": {
                        "type": "boolean",
                        "title": "True if spider parses SVN metadata to find URLs",
                        "description": "Whether the spider will parse SVN metadata in order to find URLs, default: false",
                        "default": false
                    },
                    "postForm": {
                        "type": "boolean",
                        "title": "True if spider submits POST forms",
                        "description": "Whether the spider will submit POST forms, default: true",
                        "default": true
                    },
                    "processForm": {
                        "type": "boolean",
                        "title": "True if spider processes forms",
                        "description": "Whether the spider will process forms, default: true",
                        "default": true
                    },
                    "requestWaitTime": {
                        "type": "integer",
                        "title": "Time between requests",
                        "description": "The time between the requests sent to a server in milliseconds, default: 200",
                        "default": 200
                    },
                    "sendRefererHeader": {
                        "type": "boolean",
                        "title": "True if spider sends referer",
                        "description": "Whether the spider will send the referer header, default: true",
                        "default": true
                    },
                    "threadCount": {
                        "type": "integer",
                        "title": "Number of spider threads",
                        "description": "The number of spider threads, default: 2",
                        "default": 2
                    },
                    "userAgent": {
                        "type": "string",
                        "title": "User agent",
                        "description": "The user agent to use in requests, default: '' - use the default ZAP one"
                    },
                    "scripts": { "$ref": "#/definitions/scripts" }
                }
            }
        },
        "zap-scanners": {
            "type": "array",
            "title": "ZAP Active Scanner configurations",
            "description": "Optional list of ZAP Active Scanner configurations",
            "items": {
                "type": "object",
                "title": "ZAP Active Scanner configuration",
                "properties": {
                    "name": {
                        "type": "string",
                        "title": "Name of the configuration"
                    },
                    "context": { "$ref": "#/definitions/context" },
                    "url": {
                        "type": "string",
                        "title": "Url to start scaning from",
                        "description": "Url to start scaning from, default: first context URL"
                    },
                    "defaultPolicy": {
                        "type": "string",
                        "title": "Name of the default scan policy",
                        "description": "The name of the default scan policy to use, default: Default Policy",
                        "default": "Default Policy"
                    },
                    "policy": {
                        "type": "string",
                        "title": "Name of the scan policy to use",
                        "description": "Name of the scan policy to be used, default: Default Policy"
                    },
                    "maxRuleDurationInMins": {
                        "type": "integer",
                        "title": "Max time a rule runs for",
                        "description": "The max time in minutes any individual rule will be allowed to run for, default: 0 unlimited",
                        "default": 0
                    },
                    "maxScanDurationInMins": {
                        "type": "integer",
                        "title": "Max time the scanner runs for",
                        "description": "The max time in minutes the active scanner will be allowed to run for, default: 0 unlimited",
                        "default": 0
                    },
                    "delayInMs": {
                        "type": "integer",
                        "title": "Delay between each request",
                        "description": "The delay in milliseconds between each request, use to reduce the strain on the target, default 0",
                        "default": 0
                    },
                    "addQueryParam": {
                        "type": "boolean",
                        "title": "True to add extra query parameter",
                        "description": "If set will add an extra query parameter to requests that do not have one, default: false",
                        "default": false
                    },
                    "handleAntiCSRFTokens": {
                        "type": "boolean",
                        "title": "True to handle anti CSRF tokens",
                        "description": "If set then automatically handle anti CSRF tokens, default: false",
                        "default": false
                    },
                    "injectPluginIdInHeader": {
                        "type": "boolean",
                        "title": "True to send rule ID as header",
                        "description": "If set then the relevant rule Id will be injected into the X-ZAP-Scan-ID header of each request, default: false",
                        "default": false
                    },
                    "scanHeadersAllRequests": {
                        "type": "boolean",
                        "title": "True to scan all headers",
                        "description": "If set then the headers of requests that do not include any parameters will be scanned, default: false",
                        "default": false
                    },
                    "threadPerHost": {
                        "type": "integer",
                        "title": "Max number of threads per host",
                        "description": "The max number of threads per host, default: 2",
                        "default": 2
                    },
                    "policyDefinition": {
                        "type": "object",
                        "title": "Policy definition",
                        "description": "The policy definition, only used if the 'policy' is not set - NOT YET IMPLEMENTED",
                        "properties": {
                            "defaultStrength": { "$ref": "#/definitions/strength" },
                            "defaultThreshold": { "$ref": "#/definitions/threshold" },
                            "rules": {
                                "type": "array",
                                "title": "Active scan rules and settings",
                                "description": "A list of one or more active scan rules and associated settings which override the defaults",
                                "items": {
                                    "type": "object",
                                    "title": "Active scan rule and settings",
                                    "properties": {
                                        "id": {
                                            "type": "integer",
                                            "description": "The rule id as per https://www.zaproxy.org/docs/alerts/",
                                            "title": "Rule ID"
                                        },
                                        "name": {
                                            "type": "string",
                                            "description": "The name of the rule for documentation purposes - this is not required or actually used",
                                            "title": "Name of the rule"
                                        },
                                        "strength": { "$ref": "#/definitions/strength" },
                                        "threshold": { "$ref": "#/definitions/threshold" }
                                    }
                                }
                            }
                        }
                    },
                    "scripts": { "$ref": "#/definitions/scripts" }
                }
            }
        }
    }
}